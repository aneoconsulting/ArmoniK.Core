# ArmoniK Test Applications

The ArmoniK project provides several test applications to validate that a cluster is functioning properly (e.g., after a new deployment). This page details these test applications.

**Note:** ArmoniK applications consist of two components: a client and a worker. The client submits the initial task graph and can monitor execution or retrieve results, while the worker executes tasks.

## Bench Test Application

The Bench application simulates an embarrassingly parallel workload, consisting of independent tasks. Each task submitted by the client has a single input and produces a single output. The client interface allows customization of the task graph, execution parameters, and submission process. The worker is simple: it waits for a specified duration before completing either successfully or with a failure, depending on the configuration.

### Usage

The Bench application code is part of the ArmoniK.Core repository and is written in C#. However, for ease of use, we recommend running the Docker images generated by the CI pipeline, especially when testing with an ArmoniK cluster. Image tags correspond to ArmoniK Core versions, and images are generated for each Core release, pre-release, and pull request. You can find image tags in the CI pipeline logs. All images are available on Aneo's DockerHub registry.

By default, the Bench application's worker is deployed in a partition named `bench`. For custom deployments, ensure that you create a partition and provide the appropriate worker image. The worker image follows the naming convention:

```bash
dockerhubaneo/armonik_core_bench_test_worker:<tag>
```

To run the Bench application on a cluster, use the client's Docker image with the appropriate parameters:

```bash
docker run --rm \
  -e GrpcClient__Endpoint="http://172.17.119.85:5001" \
  -e BenchOptions__Partition="bench" \
  dockerhubaneo/armonik_core_bench_test_client:0.24.3
```

**Warning:** Ensure consistency between application and cluster versions. Client versions align with Core versions, so ensure the deployed Core version matches the client version.

### Options Reference

The Bench application client exposes several parameters, passed via environment variables. To set a parameter, prepend `BenchOptions__` to the parameter name. Below is the complete list of available parameters:

| Name                        | Description                                                                 | Cast     | Default |
| --------------------------- | --------------------------------------------------------------------------- | -------- | ------- |
| `NTasks`                    | Total number of tasks submitted.                                             | Integer  | 100     |
| `TaskDurationMs`             | Execution time per task (in milliseconds).                                  | Integer  | 100     |
| `PayloadSize`                | Size of payloads (in kilobytes).                                             | Integer  | 1       |
| `ResultSize`                 | Size of results (in kilobytes).                                              | Integer  | 1       |
| `SwitchToStreamSize`         | Payload size threshold (in kilobytes) for using streams.                     | Integer  | 10      |
| `BatchSize`                  | Number of tasks per batch (high values may cause crashes).                   | Integer  | 100     |
| `TaskRpcException`           | Raise an `RpcException` if the task ID ends with this string (ignored if empty). | String   | ""      |
| `TaskError`                  | Mark the task as an error if the task ID ends with this string (ignored if empty). | String   | ""      |
| `Partition`                  | Partition to submit tasks to (must host the corresponding worker).           | String   | ""      |
| `ShowEvents`                 | Print event updates.                                                        | Boolean  | false   |
| `MaxRetries`                 | Maximum number of retries for failures.                                      | Integer  | 1       |
| `DegreeOfParallelism`        | Number of tasks processed in parallel to speed up submission.                | Integer  | 1       |
| `PurgeData`                  | Purge data from the session (may slow down execution for large task numbers). | Boolean  | true    |
| `DownloadResults`            | Download and verify that all results are correctly retrieved.                | Boolean  | true    |
| `ExitAfterSubmission`        | Exit after submitting tasks (skips post-processing).                         | Boolean  | false   |
| `PauseSessionDuringSubmission`| Pause the session during task submission and resume afterward.               | Boolean  | false   |
| `MaxDuration`                | Maximum task duration (in `hh:mm:ss.fff` format).                            | String   | 01:00:00.0 |
| `Options__<key>`             | Add key-value pairs to the task options.                                     | String   | ""      |

**Note:** While environment variables are strings, the client will cast them to the appropriate types as needed.

## Htc Mock Test Application

### Usage

### Options Reference

| Name | Description | Cast | Default |
| --------------------------- | --------------------------------------------------------------------------- | -------- | ------- |
| `NTasks`                    | Total number of tasks submitted.                                             | Integer  | 100     |
| TotalCalculationTime | Total computation time for the computing tasks. | String | 00:00:00.1 |
| DataSize | Size of the task outputs in kilobytes. | Integer | 1 |
| MemorySize | Size of the memory used by the task during its execution in kilobytes. | Integer | 1 |
| SubTasksLevels | Number of sub tasks levels. | Integer | 4 |
| EnableFastCompute | Whether the computing tasks will take the time parameter into consideration. Always used to generate the graph of task dependencies. | Boolean | true |
| EnableUseLowMem | Whether the computing tasks will take the memory usage parameter into consideration. Always used to generate the graph of task dependencies. | Boolean | true |
| EnableSmallOutput | Whether the computing tasks will take the output size parameter into consideration. Always used to generate the graph of task dependencies. | Boolean | true |
| `TaskRpcException`           | Raise an `RpcException` if the task ID ends with this string (ignored if empty). | String   | ""      |
| `TaskError`                  | Mark the task as an error if the task ID ends with this string (ignored if empty). | String   | ""      |
| `Partition`                  | Partition to submit tasks to (must host the corresponding worker).           | String   | ""      |
| `PurgeData`                  | Purge data from the session (may slow down execution for large task numbers). | Boolean  | true    |
| `Options__<key>`             | Add key-value pairs to the task options.                                     | String   | ""      |
