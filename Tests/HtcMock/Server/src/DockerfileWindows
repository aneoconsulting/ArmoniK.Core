#See https://aka.ms/containerfastmode to understand how Visual Studio uses this Dockerfile to build your images for faster debugging.

FROM mcr.microsoft.com/dotnet/runtime:6.0-nanoserver-ltsc2022 AS base

FROM mcr.microsoft.com/dotnet/sdk:6.0-windowsservercore-ltsc2022 AS build
RUN mkdir c:\\temp\\src
WORKDIR c:\\temp\\src
COPY ["Tests/HtcMock/Server/src/ArmoniK.Samples.HtcMock.Server.csproj", "Tests/HtcMock/Server/src/"]
COPY ["Common/src/ArmoniK.Core.Common.csproj", "Common/src/"]
RUN dotnet restore "Tests/HtcMock/Server/src/ArmoniK.Samples.HtcMock.Server.csproj"
COPY . .
WORKDIR "c:\\temp\\src\\Tests\\HtcMock\\Server\\src"
RUN dotnet build "ArmoniK.Samples.HtcMock.Server.csproj" -c Release -o c:\\temp\\app\\build

FROM build AS publish
RUN dotnet publish "ArmoniK.Samples.HtcMock.Server.csproj" -c Release -o c:\\temp\\app\\publish

FROM base AS final
WORKDIR c:\\temp\\app
COPY --from=publish c:\\temp\\app\\publish .

EXPOSE 1080
ENTRYPOINT ["dotnet", "ArmoniK.Samples.HtcMock.Server.dll"]
